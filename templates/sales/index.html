{% extends 'base.html' %}

{% block content %}
<c-layouts.dashboard dashboard-name="Sales">
    <c-slot name="sidebar">
        <c-sidebar.sales></c-sidebar.sales>
    </c-slot>

    <c-slot name="content">
        <!-- Heading Card -->
        <c-headingCard judul="Dashboard" deskripsi="Selamat datang di dashboard sales" heading_image_url="https://img.icons8.com/?size=100&id=6WmNGzM9j4eN&format=png&color=000000"></c-headingCard>

        <!-- Filter -->
        <section class="mb-4 bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6">
          <div class="flex flex-wrap justify-between items-center w-full gap-2">
            <h2 class="mr-2 text-lg sm:text-xl font-bold text-gray-800 dark:text-white">Filter</h2>
            <div class="flex flex-wrap gap-2">
              <form action="" method="get">
                <select id="bulan_filter" name="bulan"
                  class="rounded-lg border border-gray-300 text-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                  <option value="semua">Semua Bulan</option>
                  <option value="januari" {% if filter_bulan == 'januari' %}selected{% endif %}>Januari</option>
                  <option value="februari" {% if filter_bulan == 'februari' %}selected{% endif %}>Februari</option>
                  <option value="maret" {% if filter_bulan  == 'maret' %}selected{% endif %}>Maret</option>
                  <option value="april" {% if filter_bulan == 'april' %}selected{% endif %}>April</option>
                  <option value="mei" {% if filter_bulan == 'mei' %}selected{% endif %}>Mei</option>
                  <option value="juni" {% if filter_bulan == 'juni' %}selected{% endif %}>Juni</option>
                  <option value="juli" {% if filter_bulan == 'juli' %}selected{% endif %}>Juli</option>
                  <option value="agustus" {% if filter_bulan == 'agustus' %}selected{% endif %}>Agustus</option>
                  <option value="september" {% if filter_bulan == 'september' %}selected{% endif %}>September</option>
                  <option value="oktober" {% if filter_bulan == 'oktober' %}selected{% endif %}>Oktober</option>
                  <option value="november" {% if filter_bulan == 'november' %}selected{% endif %}>November</option>
                  <option value="desember" {% if filter_bulan == 'desember' %}selected{% endif %}>Desember</option>
                </select>
                <button type="submit"
                  class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                  Filter
                </button>
              </form>
            </div>
          </div>
        </section>

        <!-- Card -->
        <section class="mb-4 bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6">
          <div class="flex flex-wrap gap-4">
            <div class="bg-purple-100 dark:bg-purple-900 p-4 rounded-lg flex items-center flex-1 min-w-[250px]">
              <img src="https://img.icons8.com/?size=100&id=EUFks8SepuwG&format=png&color=000000" alt="Kunjungan Sekolah Baru Icon" class="w-8 h-8 mr-2">
              <div class="ml-2">
                <h3 class="text-base sm:text-lg font-semibold text-purple-800 dark:text-white">Kunjungan Sekolah Baru</h3>
                <p class="text-xl sm:text-2xl font-bold text-purple-600 dark:text-purple-300">{{ kunjungan_sekolah_baru|default_if_none:"0" }}</p>
                <p class="text-sm text-purple-600 dark:text-purple-400">{% if filter_bulan != 'semua' %}{{ filter_bulan|title }}{% else %}Bulan ini{% endif %}</p>
              </div>
            </div>
            <div class="bg-green-100 dark:bg-green-900 p-4 rounded-lg flex items-center flex-1 min-w-[250px]">
              <img src="https://img.icons8.com/?size=100&id=s4MzQ849Sdas&format=png&color=000000" alt="Kunjungan Sekolah Existing Icon" class="w-8 h-8 mr-2">
              <div class="ml-2">
                <h3 class="text-base sm:text-lg font-semibold text-green-800 dark:text-white">Kunjungan Sekolah Existing</h3>
                <p class="text-xl sm:text-2xl font-bold text-green-600 dark:text-green-300">{{ kunjungan_sekolah_existing|default_if_none:"0" }}</p>
                <p class="text-sm text-green-600 dark:text-green-400">{% if filter_bulan != 'semua' %}{{ filter_bulan|title }}{% else %}Bulan ini{% endif %}</p>
              </div>
            </div>
            <div class="bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg flex items-center flex-1 min-w-[250px]">
              <img src="https://img.icons8.com/?size=100&id=ACi0kAlgSTlE&format=png&color=000000" alt="Kunjungan Sekolah Event Icon" class="w-8 h-8 mr-2">
              <div class="ml-2">
                <h3 class="text-base sm:text-lg font-semibold text-yellow-800 dark:text-white">Kunjungan Sekolah Event</h3>
                <p class="text-xl sm:text-2xl font-bold text-yellow-600 dark:text-yellow-300">{{ kunjungan_sekolah_event|default_if_none:"0" }}</p>
                <p class="text-sm text-yellow-600 dark:text-yellow-400">{% if filter_bulan != 'semua' %}{{ filter_bulan|title }}{% else %}Bulan ini{% endif %}</p>
              </div>
            </div>
            <div class="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg flex items-center flex-1 min-w-[250px]">
              <img src="https://img.icons8.com/?size=100&id=NDixIIZr9Mpc&format=png&color=000000" alt="Pertemuan Client Icon" class="w-8 h-8 mr-2">
              <div class="ml-2">
                <h3 class="text-base sm:text-lg font-semibold text-blue-800 dark:text-white">Pertemuan Client (Non Sekolah)</h3>
                <p class="text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-300">{{ pertemuan_client|default_if_none:"0" }}</p>
                <p class="text-sm text-blue-600 dark:text-blue-400">{% if filter_bulan != 'semua' %}{{ filter_bulan|title }}{% else %}Bulan ini{% endif %}</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Table Kegiatan -->
        <c-tableKegiatan></c-tableKegiatan>
        
        <!-- Table Sekolah -->
        <section class="mt-4">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 mb-4 w-full">
            <h2 class="text-md sm:text-2xl font-bold text-gray-800 dark:text-white mb-4">Tabel Sekolah</h2>

            <div class="flex flex-col sm:flex-row justify-between items-center w-full gap-4 mb-4">
              <div class="w-full sm:w-1/2">
                <input type="text" id="searchSekolahInput" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Cari...">
              </div>
              <div class="w-full sm:w-auto">
                <div class="relative">
                  <button id="dropdownSekolahButton" data-dropdown-toggle="dropdownSekolah" class="w-full text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800" type="button">
                    Ekspor <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
                    </svg>
                  </button>
                  <div id="dropdownSekolah" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
                    <ul class="py-2 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownSekolahButton">
                      <li>
                        <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" onclick="exportTable('sekolahTable', 'excel', 'data_sekolah')">Excel</a>
                      </li>
                      <li>
                        <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" onclick="exportTable('sekolahTable', 'csv', 'data_sekolah')">CSV</a>
                      </li>
                      <li>
                        <a href="#" class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" onclick="exportTable('sekolahTable', 'pdf', 'data_sekolah')">PDF</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Table -->
            <div class="overflow-x-auto rounded-lg w-full max-h-[500px] overflow-y-auto">
              <table id="sekolahTable" class="w-full text-sm text-center text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 sticky top-0">
                  <tr>
                    <th scope="col" class="px-6 py-3 whitespace-nowrap">Nama Yayasan</th>
                    <th scope="col" class="px-6 py-3 whitespace-nowrap">Jenjang</th>
                    <th scope="col" class="px-6 py-3 whitespace-nowrap">Nama Sekolah</th>
                    <th scope="col" class="px-6 py-3 whitespace-nowrap">Total Siswa</th>
                    <th scope="col" class="px-6 py-3 whitespace-nowrap">Total Komputer</th>
                  </tr>
                </thead>
                <tbody id="sekolahTableBody">
                  {% for sekolah in daftar_sekolah %}
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                      <td class="px-6 py-4 whitespace-nowrap">{{ sekolah.nama_yayasan|default_if_none:"-" }}</td>
                      <td class="px-6 py-4 whitespace-nowrap">{{ sekolah.jenjang|default_if_none:"-" }}</td>
                      <td class="px-6 py-4 whitespace-nowrap">{{ sekolah.nama_sekolah|default_if_none:"-" }}</td>
                      <td class="px-6 py-4 whitespace-nowrap">{{ sekolah.jumlah_seluruh_siswa|default_if_none:"-" }}</td>
                      <td class="px-6 py-4 whitespace-nowrap">{{ sekolah.jumlah_komputer|default_if_none:"-" }}</td>
                    </tr>
                  {% empty %}
                    <tr>
                      <td colspan="5" class="px-6 py-4 text-center">Tidak ada data sekolah</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Table Permintaan SPT -->
        <section class="mt-4">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 mb-4 w-full">
            <h2 class="text-md sm:text-2xl font-bold text-gray-800 dark:text-white mb-4">Riwayat Permintaan SPT</h2>
            
            <!-- Input pencarian -->
            <div class="mb-4">
              <input type="text" id="searchInput" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Cari di semua kolom...">
            </div>
            
            <div class="relative overflow-x-auto sm:rounded-lg">
              <table id="sptTable" class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                  <tr>
                    <th scope="col" class="px-6 py-3">Judul</th>
                    <th scope="col" class="px-6 py-3">Keterangan</th>
                    <th scope="col" class="px-6 py-3">Status</th>
                    <th scope="col" class="px-6 py-3">Kategori</th>
                    <th scope="col" class="px-6 py-3">File</th>
                    <th scope="col" class="px-6 py-3">Alasan</th>
                  </tr>
                </thead>
                <tbody>
                  {% for permintaan in daftar_permintaan %}
                  <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                      {{ permintaan.judul|default_if_none:"-" }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ permintaan.ket|default_if_none:"-" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ permintaan.status|default_if_none:"-" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ permintaan.kategori|default_if_none:"-" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      {% if permintaan.file %}
                        <a href="{{ permintaan.file.url }}" target="_blank" class="text-blue-600 hover:underline">Lihat File</a>
                      {% else %}
                        Tidak ada file
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      {{ permintaan.alasan|default_if_none:"-" }}
                    </td>
                  </tr>
                  {% empty %}
                  <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td colspan="5" class="px-6 py-4 text-center">Tidak ada data permintaan SPT</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </section>
    </c-slot>
</c-layouts.dashboard>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const table = document.getElementById('sptTable');
    const rows = table.getElementsByTagName('tr');

    searchInput.addEventListener('keyup', function() {
      const searchTerm = searchInput.value.toLowerCase();

      for (let i = 1; i < rows.length; i++) {
        let rowVisible = false;
        const cells = rows[i].getElementsByTagName('td');

        for (let j = 0; j < cells.length; j++) {
          if (cells[j].textContent.toLowerCase().indexOf(searchTerm) > -1) {
            rowVisible = true;
            break;
          }
        }

        rows[i].style.display = rowVisible ? '' : 'none';
      }
    });

    const searchSekolahInput = document.getElementById('searchSekolahInput');
    const sekolahTable = document.getElementById('sekolahTable');
    const sekolahRows = sekolahTable.getElementsByTagName('tr');

    searchSekolahInput.addEventListener('keyup', function() {
      const searchTerm = searchSekolahInput.value.toLowerCase();

      for (let i = 1; i < sekolahRows.length; i++) {
        let rowVisible = false;
        const cells = sekolahRows[i].getElementsByTagName('td');

        for (let j = 0; j < cells.length; j++) {
          if (cells[j].textContent.toLowerCase().indexOf(searchTerm) > -1) {
            rowVisible = true;
            break;
          }
        }

        sekolahRows[i].style.display = rowVisible ? '' : 'none';
      }
    });

    function exportTable(tableId, format, filename) {
      // Implement the export functionality here
      // You can reuse the code from the tableSekolah.html file
    }
  });
</script>
{% endblock %}
